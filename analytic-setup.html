<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
	<title>Unfetter</title>

	<!-- CSS  -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
	<link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
</head>

<body>
	<ul id='dropdown1' class='dropdown-content'>
		<li><a href="analytics.html">Unfetter|Analytic</a></li>
		<li><a href="https://github.com/unfetter-analytic/unfetter">GitHub</a></li>
		<li><a href="analytic-architecture.html">Architecture</a></li>
		<li><a href="analytic-setup.html">Setup</a></li>
		<li><a href="analytic-events.html">Generate Events</a></li>
	</ul>

	<div class="navbar-fixed">
		<nav class="application-header" role="navigation">
			<div class="nav-wrapper container">
				<a id="logo-container" href="http://www.unfetter.io" class="brand-logo"><img src="images/brand-logo.png"></a>
				<ul class="right hide-on-med-and-down">
					<li><a class="dropdown-button" href="#!" data-activates="dropdown1">Unfetter|Analytic<i class="material-icons right">arrow_drop_down</i></a></li>
					<li><a href="https://github.com/unfetter-discover/unfetter">Unfetter|Discover</a></li>
					<li><a href="https://mitre.github.io/unfetter" target="_blank">Unfetter at MITRE</a></li>
					<li><a href="stix.html">Using STIX 2.0</a></li>
				</ul>

				<ul id="nav-mobile" class="side-nav">
					<li class="active subheader"> <a href="analytics.html">Unfetter|Analytic</a></li>
					<li>
						<div class="divider"></div>
					</li>
					<li><a href="https://github.com/unfetter-analytic/unfetter">GitHub</a></li>
					<li><a href="analytic-architecture.html">Architecture</a></li>
					<li><a href="analytic-setup.html">Setup</a></li>
					<li><a href="analytic-events.html">Generate Events</a></li>
					<li>
						<div class="divider"></div>
					</li>
					<li><a target="_blank" href="https://github.com/unfetter-discover/unfetter">Unfetter|Discover</a></li>
					<li>
						<div class="divider"></div>
					</li>
					<li><a href="https://mitre.github.io/unfetter" target="_blank">Unfetter at MITRE</a></li>
					<li>
						<div class="divider"></div>
					</li>
					<li><a href="stix.html">Using STIX 2.0</a></li>

				</ul>
				<a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
			</div>
		</nav>
	</div>

	<div class="page-content container">
		<div class="section">
			<div class="container">
				<h1>Unfetter|Analytic Setup</h1>
				<div class="row">
					<div class="col s12">
						<p>
							Version 0.2.0 of Unfetter-Analytic features a move from Vagrant to Docker for the server side system.  This allows unfetter-discover
							web application to be loaded and run with the analytic system.  
					</div>
				</div>

				<div class="row">
					<div class="col s12">
						<p>
							The Unfetter|Analytic server side system is built using Docker to easily spin up containers for running each of the desired applications.  
							These instructions show how to setup the Windows Victim system with Vagrant. Services will be configured and started, Windows event
							logs and Sysmon data will be forwarded and ingested, and Kibana dashboards will be running, analytics will run and alerts will be pushed to 
							Unfetter-Discover.
					</div>
				</div>
			</div>
		</div>

		<div class="section">
			<div class="container">
				<h2>The Base System</h2>
				<div class="row">
					<div class="col s12">
						<p>
							The Unfetter|Analytic system was tested on Windows 7 Professional and Windows 10 Home host operating systems (OSes) using
							VirtualBox. However, any OS that supports Vagrant should work, since both systems run in virtual machines (VMs).
						</p>
						<p>
							If using Windows as your host OS we recommend you run a Bash client to interact with Vagrant, but it is not strictly necessary.
						</p>
						<p>
							Under the main directory, there are two sub-directories: unfetter-analytic and unfetter-windows. The unfetter-analytic system contains a docker-compose.yml
							file for using docker-compose to create the system.  The unfetter-windows directory contains a  Vagrantfile and all the scripts necessary to provision each system. 
							When first starting each VM with <code>vagrant up</code>,
							Vagrant provisioning will go out and install all the software needed for each VM. No software, other than source code,
							is provided in the GitHub project.
						</p>
						<h3>To install the prerequisites</h3>
						<ul class="collection">
							<li class="collection-item">Install <a href="https://www.docker.com/products/overview" target="_blank">Docker</a></li>
							<li class="collection-item">Install <a href="https://www.vagrantup.com/docs/installation" target="_blank">Vagrant</a></li>
							<li class="collection-item">Install <a href="https://www.virtualbox.comwiki/Downloads" target="_blank">Oracle's VirtualBox</a></li>
							<li class="collection-item">Install a git client and run <strong>clone github.com/unfetter-analytic/unfetter.git</strong></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<h2>Proxy Setup (optional)</h2>
				<div class="row">
					<div class="col s12">
						<p>
							We recommend that you avoid using an HTTP proxy when setting up Unfetter. If you must use a proxy you will need to configure
							Vagrant appropriately. One option is to use the <a href="https://github.com/tmatilai/vagrant-proxyconf" target="_blank">vagrant=proxyconf</a> plugin.
						</p>
						<p>
							During limited testing with a proxy we have noticed that Vagrant has trouble communicating with Unfetter Windows VM over
							WinRM, resulting in WinRM errors. WinRM appears to be trying to resolve 127.0.0.1 using the proxy, despite the no_proxy
							settings. Removing the proxy environment variable in the host OS command prompt using <strong>set http_proxy=</strong> fixes the issue.
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<h2>Starting The Server</h2>
				<div class="row">
					<div class="col s12">
						<p>The Unfetter|Analytic Linux VM contains the ELK stack, Apache Spark, and the Python (PySpark) files that run the analytics.</p>
						<p>The Windows VM is a Windows 7 32-bit with Microsoft Sysmon and Nxlog installed. Nxlog is already configured to send
							logs to Unfetter|Analytic. </p>
						<p>There are a number of GitHub projects needed to run the Unfetter Analytic system.  They are all found under 
							<a href="https://www.github.com/unfetter-analytic" target="_blank">www.github.com/unfetter-analytic</a></p>.  You can easily clone all those projects
							in a couple of easy steps:</a>
						<p><pre><code>mkdir unfetter-analytic;cd unfetter-analytic</p>
						<p>To clone all the projects, just use this script</p>
						<p><pre><code> curl -s https://api.github.com/orgs/unfetter-analytic/repos\?per_page\=200 | perl -ne 'print "$1\n" if (/"clone_url": "([^"]+)/)' | xargs -n 1 git clone</p>

						<p><pre><code>cd ./unfetter</p>
						<p>Type: <br>docker-compose up</code></pre></p>

						<p>In analytic-system directory, there is a file called run.sh.  Docker will run this file as the main workhorse for the analytic system. It is looping through
							all the analytics and running them, pushing any results to Elasticsearch AND the locally created Unfetter-Discover.  Change run.sh to perform whatever
							analytics you want.  
						<p>Wait until Docker has started.    There
							won't be any data until the Windows system begins running and forwards events.</p>
						<p>The running docker container "analytic-system" has the analytics.  If you want to run analytics individually, attach to this container to run them.</p>
					</div>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<h2>Starting Windows Victim</h2>
				<div class="row">
					<div class="col s12">
						<p>Setting up the Windows system the first time has a few more steps than setting up the analytic server. You will need
							a version of Windows 7 that can be created as a box file. There are a few ways to do this, but these instructions will
							show you how to use <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/" target="_blank">modern.ie</a> to download an evaluation copy of Windows 7 from Microsoft.
						</p>

						<ul class="collection">
							<li class="collection-item">Go to the <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/" target="_blank">modern.ie</a> site
								and download an IE11 on Win7 Virtual Machine for the Vagrant platform.</li>
							<li class="collection-item">Unzip IE11.Win7.Vagrant.zip and load the box file (IE11 - Win7.box) to your host computer. The box file is a VM packaged
								with metadata that Vagrant uses as a starting point for your VM.</li>
							<li class="collection-item">Go to the directory where you unzipped the .box file and run the command: <strong>vagrant box add win7 'IE11 - Win7.box'</strong></li>
							<li class="collection-item">Your Vagrant system should now have a base Windows 7 image called <i>Win7</i>.</li>
							<li class="collection-item">Go to the "unfetter-windows" directory and run: <strong>vagrant up</strong></li>
						</ul>
						<p>
							Vagrant won't be able to complete the provisioning on its own. Manual configuration of Vagrant is necessary so that Vagrant
							can communicate with the guest Windows OS. When the Windows GUI starts, do the following on the VirtualBox window
						</p>
						<p>
							<ul class="collection">
								<li class="collection-item">Set the network location to Home or Work. Go to Control panel -> Network and Sharing Center and click on "Public network"
									under "View Your Active Networks" in order to change the type.</li>
								<li class="collection-item">Run the following script as administrator:</li>
								<li class="collection-item">@echo off<br> set WINRM_EXEC=call %SYSTEMROOT%\System32\winrm<br> %WINRM_EXEC% quickconfig -q<br> %WINRM_EXEC% set
									winrm/config/winrs @{MaxMemoryPerShellMB="300"}<br> %WINRM_EXEC% set winrm/config @{MaxTimeoutms="1800000"}<br> %WINRM_EXEC%
									set winrm/config/client/auth @{Basic="true"}<br> %WINRM_EXEC% set winrm/config/service @{AllowUnencrypted="true"}<br>%WINRM_EXEC% set winrm/config/service/auth @{Basic="true"}</li>
							</ul>
						</p>
						<p>
							This script is located in unfetter-windows/resources/winrm.cmd on the host OS. After you change the network type in the guest
							OS the script will be accessible under \\VBOXSVR\vagrant\resources. Either execute it from that location or copy it
							and paste it into a new .cmd file on the guest OS using Notepad.
						</p>
						<p>
							Navigate back to the window where "vagrant up" was executed. Provisioning should continue now that Vagrant can communicate
							with the guest OS. Vagrant will install and configure Sysmon and Nxlog. When it is all done, check the following log
							file for errors to make sure the Windows machine can see the analytic server: <strong>c:\Program Files\nxlog\data\nxlog.log</strong>
						</p>

						<p>
							The VM can be accessed through the GUI. If you used Modern.ie, then the credentials are "IEUser/Passw0rd!"
						</p>
						<p>
							It is HIGHLY recommended that if you work with Microsoft Windows, you purchase a licensed copy and build your own Vagrant
							box file. If you want to make your own base Windows box, this
							<a href="http://www.hurryupandwait.io/blog/creating-windows-base-images-for-virtualbox-and-hyper-v-using-packer-boxstarter-and-vagrant"
							   target="_blank">webpage</a> has an example.
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<h2>Web Interfaces</h2>
				<div class="row">
					<div class="col s12">
						<p>
							Unfetter|Analytic provides three interfaces to see your collected data. Kibana provides a full-featured interface to perform
							complex searches. You can access it at: <strong>https://localhost</strong>
						</p>
						<p>
							The Elasticsearch head plugin provides a simple interface that allows you to browse through the collected data. It is accessible
							at: <strong>https://localhost/elasticsearch/_plugin/head</strong>
						</p>
						<p>The Unfetter-Discover system is avilable at <strong>https://localhost/unfetter-discover</strong></p>
						<p>Next, learn to <a href="analytic-events.html">Generate Events</a></p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<footer class="application-header">
		<div class="footer-copyright">
			<div class="container">
				Made by <a class="white text-lighten-3" target="_blank" href="http://www.iad.gov">NSA Information Assurance</a>
			</div>
		</div>
	</footer>


	<!--  Scripts-->
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="js/materialize.js"></script>
	<script src="js/init.js"></script>

</body>

</html>
